{% extends "./base.html" %} {% load static %} {% block content %}

{% if request.user.is_authenticated %}

    

    <div class="cart-pret" style="position: relative;">

        <div class="bg-pop-up" style="position: absolute; background-color: rgba(255, 255, 255, 1); width: 100%; height: 100%; z-index: 1000; display: none;">
            <form class="" autocomplete="off" method='POST'>
                {% csrf_token %}
                {{form.as_p}}

                <button>Submit</button>
            </form>
        </div>
        
        <div class="header">
            <div class="produs">Produse</div>
            <div class="price">Pret</div>
            <div class="quantity">Cantitate</div>
            <div class="delete">Stergere</div>
        </div>

        {% for produs in produse_cart %}
        <div class="products" id=produscos{{produs.id}}>
            <div class="produs">
                <img src="{{produs.cart.image.url}}" alt="">
                <p>{{produs.cart.title}}</p>
            </div>
            <div class="price">
                <p>{{produs.cart.price}}</p>
            </div>
            <div class="quantity">
                <p>{{produs.quantity}}</p>
            </div>
            <div class="delete">
                <button onclick="deletecart({{produs.id}})">
                    <span class="material-icons">close</span>
                </button>
            </div>
        </div>
        {% endfor %}
        <h3>Total {{total}} Ron</h3>

        <div class="submit">
            <button type="submit" name="post" class="comanda" onclick="popup()">Comanda</button>
        </div>
    </div>

    <script>
        function popup() {
          var x = document.querySelector(".bg-pop-up");
          console.log(x);
          if (x.style.display === "none") {
            x.style.display = "block";
          } else {
            x.style.display = "none";
          }
        }
    </script>


    <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>



    <script> 
        function deletecart(id) {
            console.log(id);
            const produs = document.querySelector('#produscos'+id)
            $.ajax({
                type: 'POST',
                url: '{% url "store:delete_cart" %}',
                data: {
                    produsid: id,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    action: 'delete',
                },
                success: function(json) {
                    if(json['delete'] === 'delete') {
                        produs.style.display = 'none';
                        window.location.href = '{% url "store:cart" %}';

                    }
                },
                error: function (xhr, errmsg, err) {

                }
            });
        }
    </script>

{%else%}
<h1 class="error"> Trebuie sa fiti autentificat pentru a vedea cosul. </h1>

{%endif%}

{% endblock %}